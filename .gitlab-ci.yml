stages:
  - build
  - run
  - test

variables:
  PROJECT_DIR: "nadinsoftTask"

# ðŸ§± Stage 1: Build Docker images
build:
  stage: build
  tags: [shell]
  script:
    - cd $PROJECT_DIR
    - echo "Building Docker images..."
    - docker compose build

# ðŸš€ Stage 2: Run services
run:
  stage: run
  tags: [shell]
  script:
    - cd $PROJECT_DIR
    - echo "Starting services..."
    - docker compose up -d
    - docker compose ps
  when: on_success

# âœ… Stage 3: Test application
test:
  stage: test
  tags: [shell]
  script:
    - cd $PROJECT_DIR
    - echo "Testing web server..."
    - sleep 5   # ØµØ¨Ø± Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ù„Ø§ Ø¢Ù…Ø¯Ù† Ø³Ø±ÙˆØ±
    - curl -fsS http://localhost:5000 | tee output.txt
  after_script:
    - cd $PROJECT_DIR
    - docker compose down -v
  artifacts:
    when: always
    paths:
      - $PROJECT_DIR/output.txt
